<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Classification example - HR dataset • SAFE</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top navbar-mi2" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-mi2logo" href="http://DrWhy.AI/">
        <img src="https://github.com/ModelOriented/DrWhyTemplate/blob/master/inst/pkgdown/assets/drwhy_znak_violet_small.jpg?raw=true" alt="MI2" height="46" title="MI2"></a>
      <a class="navbar-brand navbar-mi2" href="../index.html"></a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="navbar-mi2 nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/example_apartments.html">Regression example - apartments dataset</a>
    </li>
    <li>
      <a href="../articles/example_hr.html">Classification example - HR dataset</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MI2DataLab/SAFE">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Classification example - HR dataset</h1>
                        <h4 class="author">Anna Gierlak</h4>
            
            <h4 class="date">2019-07-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/MI2DataLab/SAFE/blob/master/vignettes/example_hr.Rmd"><code>vignettes/example_hr.Rmd</code></a></small>
      <div class="hidden name"><code>example_hr.Rmd</code></div>

    </div>

    
    
<p>In this vignette we present an example of an application of <code>SAFE</code> package in case of classification problems. It is based on the <code>HR_data</code> dataset which comes from the <code>breakDown</code> package but is also available in the <code>SAFE</code> package. We will use this dataset to predict odds that someone will leave the company.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(SAFE)
<span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(HR_data)
<span class="co">#&gt;   satisfaction_level last_evaluation number_project average_montly_hours</span>
<span class="co">#&gt; 1               0.38            0.53              2                  157</span>
<span class="co">#&gt; 2               0.80            0.86              5                  262</span>
<span class="co">#&gt; 3               0.11            0.88              7                  272</span>
<span class="co">#&gt; 4               0.72            0.87              5                  223</span>
<span class="co">#&gt; 5               0.37            0.52              2                  159</span>
<span class="co">#&gt; 6               0.41            0.50              2                  153</span>
<span class="co">#&gt;   time_spend_company Work_accident left promotion_last_5years sales salary</span>
<span class="co">#&gt; 1                  3             0    1                     0 sales    low</span>
<span class="co">#&gt; 2                  6             0    1                     0 sales medium</span>
<span class="co">#&gt; 3                  4             0    1                     0 sales medium</span>
<span class="co">#&gt; 4                  5             0    1                     0 sales    low</span>
<span class="co">#&gt; 5                  3             0    1                     0 sales    low</span>
<span class="co">#&gt; 6                  3             0    1                     0 sales    low</span></code></pre></div>
<div id="building-a-black-box-model" class="section level2">
<h2 class="hasAnchor">
<a href="#building-a-black-box-model" class="anchor"></a>Building a black-box model</h2>
<p>First we fit a xgboost model to the original <code>HR_data</code> dataset - this is our complex model that will serve us as a surrogate. Before that we need to prepare our data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data_hr_mm &lt;-<span class="st"> </span>stats<span class="op">::</span><span class="kw"><a href="https://rdrr.io/r/stats/model.matrix.html">model.matrix</a></span>(left <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> HR_data)[,<span class="op">-</span><span class="dv">1</span>]
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(xgboost)
data_hr_dm &lt;-<span class="st"> </span><span class="kw">xgb.DMatrix</span>(data_hr_mm, <span class="dt">label =</span> (HR_data<span class="op">$</span>left <span class="op">==</span><span class="st"> "1"</span>))

model_xgb &lt;-<span class="st"> </span><span class="kw">xgb.train</span>(<span class="dt">params =</span> <span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">objective =</span> <span class="st">"binary:logistic"</span>), <span class="dt">data =</span> data_hr_dm, <span class="dt">nrounds =</span> <span class="dv">100</span>)</code></pre></div>
</div>
<div id="creating-an-explainer" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-an-explainer" class="anchor"></a>Creating an explainer</h2>
<p>We also create an <code>explainer</code> object that will be necessary to make use of functionalities of the <code>SAFE</code> package.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(DALEX)
explainer_xgb &lt;-<span class="st"> </span><span class="kw">explain</span>(model_xgb,
                         <span class="dt">data =</span> data_hr_mm,
                         <span class="dt">y =</span> HR_data<span class="op">$</span>left,
                         <span class="dt">label =</span> <span class="st">"xgb"</span>)
explainer_xgb
<span class="co">#&gt; Model label:  xgb </span>
<span class="co">#&gt; Model class:  xgb.Booster </span>
<span class="co">#&gt; Data head  :</span>
<span class="co">#&gt;   satisfaction_level last_evaluation number_project average_montly_hours</span>
<span class="co">#&gt; 1               0.38            0.53              2                  157</span>
<span class="co">#&gt; 2               0.80            0.86              5                  262</span>
<span class="co">#&gt;   time_spend_company Work_accident promotion_last_5years saleshr salesIT</span>
<span class="co">#&gt; 1                  3             0                     0       0       0</span>
<span class="co">#&gt; 2                  6             0                     0       0       0</span>
<span class="co">#&gt;   salesmanagement salesmarketing salesproduct_mng salesRandD salessales</span>
<span class="co">#&gt; 1               0              0                0          0          1</span>
<span class="co">#&gt; 2               0              0                0          0          1</span>
<span class="co">#&gt;   salessupport salestechnical salarylow salarymedium</span>
<span class="co">#&gt; 1            0              0         1            0</span>
<span class="co">#&gt; 2            0              0         0            1</span></code></pre></div>
</div>
<div id="creating-a-safe_extractor" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-a-safe_extractor" class="anchor"></a>Creating a safe_extractor</h2>
<p>Now, we create a <code>safe_extractor</code> object using <code>SAFE</code> package and our surrogate model. Setting the argument <code>verbose=FALSE</code> stops progress bar from printing.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">safe_extractor &lt;-<span class="st"> </span><span class="kw"><a href="../reference/safe_extraction.html">safe_extraction</a></span>(explainer_xgb, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p>Now, let’s print summary for the new object we have just created.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(safe_extractor)
<span class="co">#&gt; Variable 'satisfaction_level' - selected intervals:</span>
<span class="co">#&gt;  (-Inf, 0.11]</span>
<span class="co">#&gt;      (0.11, 0.29]</span>
<span class="co">#&gt;      (0.29, 0.46]</span>
<span class="co">#&gt;      (0.46, 0.7]</span>
<span class="co">#&gt;      (0.7, Inf)</span>
<span class="co">#&gt; Variable 'last_evaluation' - selected intervals:</span>
<span class="co">#&gt;  (-Inf, 0.43]</span>
<span class="co">#&gt;      (0.43, 0.77]</span>
<span class="co">#&gt;      (0.77, 0.98]</span>
<span class="co">#&gt;      (0.98, Inf)</span>
<span class="co">#&gt; Variable 'number_project' - selected intervals:</span>
<span class="co">#&gt;  (-Inf, 4]</span>
<span class="co">#&gt;      (4, Inf)</span>
<span class="co">#&gt; Variable 'average_montly_hours' - selected intervals:</span>
<span class="co">#&gt;  (-Inf, 118]</span>
<span class="co">#&gt;      (118, 159]</span>
<span class="co">#&gt;      (159, 215]</span>
<span class="co">#&gt;      (215, 245]</span>
<span class="co">#&gt;      (245, Inf)</span>
<span class="co">#&gt; Variable 'time_spend_company' - selected intervals:</span>
<span class="co">#&gt;  (-Inf, 4]</span>
<span class="co">#&gt;      (4, Inf)</span>
<span class="co">#&gt; Variable 'Work_accident' - no transformation suggested.</span>
<span class="co">#&gt; Variable 'promotion_last_5years' - no transformation suggested.</span>
<span class="co">#&gt; Variable 'saleshr' - no transformation suggested.</span>
<span class="co">#&gt; Variable 'salesIT' - no transformation suggested.</span>
<span class="co">#&gt; Variable 'salesmanagement' - no transformation suggested.</span>
<span class="co">#&gt; Variable 'salesmarketing' - no transformation suggested.</span>
<span class="co">#&gt; Variable 'salesproduct_mng' - no transformation suggested.</span>
<span class="co">#&gt; Variable 'salesRandD' - no transformation suggested.</span>
<span class="co">#&gt; Variable 'salessales' - no transformation suggested.</span>
<span class="co">#&gt; Variable 'salessupport' - no transformation suggested.</span>
<span class="co">#&gt; Variable 'salestechnical' - no transformation suggested.</span>
<span class="co">#&gt; Variable 'salarylow' - no transformation suggested.</span>
<span class="co">#&gt; Variable 'salarymedium' - no transformation suggested.</span></code></pre></div>
<p>We can see transormation propositions for all variables in our dataset.</p>
<p>In the plot below we can see which points have been chosen to be the breakpoints for a particular variable:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="https://rdrr.io/r/graphics/plot.html">plot</a></span>(safe_extractor, <span class="dt">variable =</span> <span class="st">"average_montly_hours"</span>)</code></pre></div>
<p><img src="example_hr_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
</div>
<div id="transforming-data" class="section level2">
<h2 class="hasAnchor">
<a href="#transforming-data" class="anchor"></a>Transforming data</h2>
<p>Now we can use our <code>safe_extractor</code> object to create new categorical features in the given dataset.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">data_xgb &lt;-<span class="st"> </span><span class="kw"><a href="../reference/safely_transform_data.html">safely_transform_data</a></span>(safe_extractor, data_hr_mm, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">satisfaction_level</th>
<th align="right">last_evaluation</th>
<th align="right">number_project</th>
<th align="right">average_montly_hours</th>
<th align="right">time_spend_company</th>
<th align="right">Work_accident</th>
<th align="right">promotion_last_5years</th>
<th align="right">saleshr</th>
<th align="right">salesIT</th>
<th align="right">salesmanagement</th>
<th align="right">salesmarketing</th>
<th align="right">salesproduct_mng</th>
<th align="right">salesRandD</th>
<th align="right">salessales</th>
<th align="right">salessupport</th>
<th align="right">salestechnical</th>
<th align="right">salarylow</th>
<th align="right">salarymedium</th>
<th align="left">satisfaction_level_new</th>
<th align="left">last_evaluation_new</th>
<th align="left">number_project_new</th>
<th align="left">average_montly_hours_new</th>
<th align="left">time_spend_company_new</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0.38</td>
<td align="right">0.53</td>
<td align="right">2</td>
<td align="right">157</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">(0.29, 0.46]</td>
<td align="left">(0.43, 0.77]</td>
<td align="left">(-Inf, 4]</td>
<td align="left">(118, 159]</td>
<td align="left">(-Inf, 4]</td>
</tr>
<tr class="even">
<td align="right">0.80</td>
<td align="right">0.86</td>
<td align="right">5</td>
<td align="right">262</td>
<td align="right">6</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">(0.7, Inf)</td>
<td align="left">(0.77, 0.98]</td>
<td align="left">(4, Inf)</td>
<td align="left">(245, Inf)</td>
<td align="left">(4, Inf)</td>
</tr>
<tr class="odd">
<td align="right">0.11</td>
<td align="right">0.88</td>
<td align="right">7</td>
<td align="right">272</td>
<td align="right">4</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">(-Inf, 0.11]</td>
<td align="left">(0.77, 0.98]</td>
<td align="left">(4, Inf)</td>
<td align="left">(245, Inf)</td>
<td align="left">(-Inf, 4]</td>
</tr>
<tr class="even">
<td align="right">0.72</td>
<td align="right">0.87</td>
<td align="right">5</td>
<td align="right">223</td>
<td align="right">5</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">(0.7, Inf)</td>
<td align="left">(0.77, 0.98]</td>
<td align="left">(4, Inf)</td>
<td align="left">(215, 245]</td>
<td align="left">(4, Inf)</td>
</tr>
<tr class="odd">
<td align="right">0.37</td>
<td align="right">0.52</td>
<td align="right">2</td>
<td align="right">159</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">(0.29, 0.46]</td>
<td align="left">(0.43, 0.77]</td>
<td align="left">(-Inf, 4]</td>
<td align="left">(118, 159]</td>
<td align="left">(-Inf, 4]</td>
</tr>
<tr class="even">
<td align="right">0.41</td>
<td align="right">0.50</td>
<td align="right">2</td>
<td align="right">153</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">(0.29, 0.46]</td>
<td align="left">(0.43, 0.77]</td>
<td align="left">(-Inf, 4]</td>
<td align="left">(118, 159]</td>
<td align="left">(-Inf, 4]</td>
</tr>
</tbody>
</table>
<p>We can also perform feature selection if we wish. For each original feature it keeps exactly one of their forms - original one or transformed one.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">vars &lt;-<span class="st"> </span><span class="kw"><a href="../reference/safely_select_variables.html">safely_select_variables</a></span>(safe_extractor, data_xgb, <span class="dt">y =</span> HR_data<span class="op">$</span>left, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)
data_xgb &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(HR_data[<span class="st">"left"</span>], data_xgb[,vars])
<span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(vars)
<span class="co">#&gt;  [1] "Work_accident"            "promotion_last_5years"   </span>
<span class="co">#&gt;  [3] "saleshr"                  "salesIT"                 </span>
<span class="co">#&gt;  [5] "salesmanagement"          "salesmarketing"          </span>
<span class="co">#&gt;  [7] "salesproduct_mng"         "salesRandD"              </span>
<span class="co">#&gt;  [9] "salessales"               "salessupport"            </span>
<span class="co">#&gt; [11] "salestechnical"           "salarylow"               </span>
<span class="co">#&gt; [13] "salarymedium"             "satisfaction_level_new"  </span>
<span class="co">#&gt; [15] "last_evaluation_new"      "number_project_new"      </span>
<span class="co">#&gt; [17] "average_montly_hours_new" "time_spend_company_new"</span></code></pre></div>
<p>It can be observed that for some features the original form was preffered and for others the transformed one.</p>
<p>Here are the first few rows for our data after feature selection:</p>
<table class="table">
<thead><tr class="header">
<th align="right">left</th>
<th align="right">Work_accident</th>
<th align="right">promotion_last_5years</th>
<th align="right">saleshr</th>
<th align="right">salesIT</th>
<th align="right">salesmanagement</th>
<th align="right">salesmarketing</th>
<th align="right">salesproduct_mng</th>
<th align="right">salesRandD</th>
<th align="right">salessales</th>
<th align="right">salessupport</th>
<th align="right">salestechnical</th>
<th align="right">salarylow</th>
<th align="right">salarymedium</th>
<th align="left">satisfaction_level_new</th>
<th align="left">last_evaluation_new</th>
<th align="left">number_project_new</th>
<th align="left">average_montly_hours_new</th>
<th align="left">time_spend_company_new</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">(0.29, 0.46]</td>
<td align="left">(0.43, 0.77]</td>
<td align="left">(-Inf, 4]</td>
<td align="left">(118, 159]</td>
<td align="left">(-Inf, 4]</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">(0.7, Inf)</td>
<td align="left">(0.77, 0.98]</td>
<td align="left">(4, Inf)</td>
<td align="left">(245, Inf)</td>
<td align="left">(4, Inf)</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">(-Inf, 0.11]</td>
<td align="left">(0.77, 0.98]</td>
<td align="left">(4, Inf)</td>
<td align="left">(245, Inf)</td>
<td align="left">(-Inf, 4]</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">(0.7, Inf)</td>
<td align="left">(0.77, 0.98]</td>
<td align="left">(4, Inf)</td>
<td align="left">(215, 245]</td>
<td align="left">(4, Inf)</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">(0.29, 0.46]</td>
<td align="left">(0.43, 0.77]</td>
<td align="left">(-Inf, 4]</td>
<td align="left">(118, 159]</td>
<td align="left">(-Inf, 4]</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">(0.29, 0.46]</td>
<td align="left">(0.43, 0.77]</td>
<td align="left">(-Inf, 4]</td>
<td align="left">(118, 159]</td>
<td align="left">(-Inf, 4]</td>
</tr>
</tbody>
</table>
</div>
<div id="creating-white-box-models-on-original-and-transformed-datasets" class="section level2">
<h2 class="hasAnchor">
<a href="#creating-white-box-models-on-original-and-transformed-datasets" class="anchor"></a>Creating white-box models on original and transformed datasets</h2>
<p>Let’s fit a logistic regression model as a white-box model to data containg newly created columns:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model_lr2 &lt;-<span class="st"> </span>stats<span class="op">::</span><span class="kw"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span>(left <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> data_xgb, <span class="dt">family =</span> <span class="kw"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span>())</code></pre></div>
<p>Moreover, we create a logistic regression model based on original <code>HR_data</code> dataset in order to check if our methodology improves results.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">model_lr1 &lt;-<span class="st"> </span>stats<span class="op">::</span><span class="kw"><a href="https://rdrr.io/r/stats/glm.html">glm</a></span>(left <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> HR_data, <span class="dt">family =</span> <span class="kw"><a href="https://rdrr.io/r/stats/family.html">binomial</a></span>())</code></pre></div>
</div>
<div id="comparing-models-performance" class="section level2">
<h2 class="hasAnchor">
<a href="#comparing-models-performance" class="anchor"></a>Comparing models performance</h2>
<p>Final step is the comparison of all the models we have created. For that purpose we make predictions and print confusion matrices for all three models:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">confusion_matrix &lt;-<span class="st"> </span><span class="cf">function</span>(y_true, y_pred) {
  cm &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(<span class="dt">pred_0 =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(y_true<span class="op">==</span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>y_pred<span class="op">==</span><span class="dv">0</span>), <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(y_true<span class="op">==</span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>y_pred<span class="op">==</span><span class="dv">0</span>)),
                   <span class="dt">pred_1 =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(y_true<span class="op">==</span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>y_pred<span class="op">==</span><span class="dv">1</span>), <span class="kw"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(y_true<span class="op">==</span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>y_pred<span class="op">==</span><span class="dv">1</span>)))
  <span class="kw"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span>(cm) &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"actual_0"</span>, <span class="st">"actual_1"</span>)
  cm
}

y_true &lt;-<span class="st"> </span>HR_data<span class="op">$</span>left
pred_xgb &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(model_xgb, data_hr_mm))
pred_lr1 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(model_lr1, <span class="dt">type =</span> <span class="st">'response'</span>))
pred_lr2 &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Round.html">round</a></span>(<span class="kw"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span>(model_lr2, <span class="dt">type =</span> <span class="st">'response'</span>))

<span class="kw">confusion_matrix</span>(y_true, pred_xgb)
<span class="co">#&gt;          pred_0 pred_1</span>
<span class="co">#&gt; actual_0  11419      9</span>
<span class="co">#&gt; actual_1     39   3532</span>
<span class="kw">confusion_matrix</span>(y_true, pred_lr1)
<span class="co">#&gt;          pred_0 pred_1</span>
<span class="co">#&gt; actual_0  10614    814</span>
<span class="co">#&gt; actual_1   2301   1270</span>
<span class="kw">confusion_matrix</span>(y_true, pred_lr2)
<span class="co">#&gt;          pred_0 pred_1</span>
<span class="co">#&gt; actual_0  10981    447</span>
<span class="co">#&gt; actual_1    434   3137</span></code></pre></div>
<p>We can see that the xgboost model has much higher accuracy than the original logistic regression model. But using transformations extracted from the more complicated xgboost model we can improve the performace of the simpler one.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#building-a-black-box-model">Building a black-box model</a></li>
      <li><a href="#creating-an-explainer">Creating an explainer</a></li>
      <li><a href="#creating-a-safe_extractor">Creating a safe_extractor</a></li>
      <li><a href="#transforming-data">Transforming data</a></li>
      <li><a href="#creating-white-box-models-on-original-and-transformed-datasets">Creating white-box models on original and transformed datasets</a></li>
      <li><a href="#comparing-models-performance">Comparing models performance</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Anna Gierlak, Przemyslaw Biecek.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
