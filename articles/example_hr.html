<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Classification example - HR data • rSAFE</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- dalexverse --><link href="../dalexverse.css" rel="stylesheet">
<link href="../dalexverse-2.css" rel="stylesheet">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Classification example - HR data">
<meta property="og:description" content="rSAFE">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- google analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-5650686-14"></script><script>
 window.dataLayer = window.dataLayer || [];
 function gtag(){dataLayer.push(arguments);}
 gtag('js', new Date());

 gtag('config', 'UA-5650686-14');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">rSAFE</a>
        <div class="info">
          <span class="partof">part of the <a href="https://github.com/ModelOriented/DrWhy" class="external-link">DrWhy.AI</a>
           developed by the <a href="https://mi2.mini.pw.edu.pl/" class="external-link">MI^2 DataLab</a> </span>
          <span class="version version-default">0.1.4</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/example_apartments.html">Regression example - apartments data</a>
    </li>
    <li>
      <a href="../articles/example_hr.html">Classification example - HR data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
        <li>
  <a href="https://github.com/ModelOriented/rSAFE/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="example_hr_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Classification example - HR data</h1>
                        <h4 data-toc-skip class="author">Anna Gierlak</h4>
            
            <h4 data-toc-skip class="date">2022-08-13</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ModelOriented/rSAFE/blob/HEAD/vignettes/example_hr.Rmd" class="external-link"><code>vignettes/example_hr.Rmd</code></a></small>
      <div class="hidden name"><code>example_hr.Rmd</code></div>

    </div>

    
    
<p>In this vignette we demonstrate an application of the <code>rSAFE</code> package to the <code>HR_data</code> set. The dataset contains information from a Human Resources department about employees and may be used in the classification task of predicting whether an employee is likely to leave the company. The data comes from the Kaggle competition “Human Resources Analytics” and is available in <code>breakDown</code> and <code>rSAFE</code> packages.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ModelOriented/rSAFE" class="external-link">rSAFE</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">HR_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;   satisfaction_level last_evaluation number_project average_monthly_hours</span></span>
<span><span class="co">#&gt; 1               0.38            0.53              2                   157</span></span>
<span><span class="co">#&gt; 2               0.80            0.86              5                   262</span></span>
<span><span class="co">#&gt; 3               0.11            0.88              7                   272</span></span>
<span><span class="co">#&gt; 4               0.72            0.87              5                   223</span></span>
<span><span class="co">#&gt; 5               0.37            0.52              2                   159</span></span>
<span><span class="co">#&gt; 6               0.41            0.50              2                   153</span></span>
<span><span class="co">#&gt;   time_spend_company work_accident left promotion_last_5years sales salary</span></span>
<span><span class="co">#&gt; 1                  3             0    1                     0 sales    low</span></span>
<span><span class="co">#&gt; 2                  6             0    1                     0 sales medium</span></span>
<span><span class="co">#&gt; 3                  4             0    1                     0 sales medium</span></span>
<span><span class="co">#&gt; 4                  5             0    1                     0 sales    low</span></span>
<span><span class="co">#&gt; 5                  3             0    1                     0 sales    low</span></span>
<span><span class="co">#&gt; 6                  3             0    1                     0 sales    low</span></span></code></pre></div>
<p>As explanatory variables we use all available in the dataset except for  which specifies department in which the employee works for.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">HR_data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">HR_data</span><span class="op">)</span> <span class="op">!=</span> <span class="st">"sales"</span><span class="op">]</span></span></code></pre></div>
<p>In order to ensure the final errors are computed on the data which has not been seen by an appropriate model, we divide our data as follows:</p>
<ul>
<li>
<code>data1</code> - the data which initial black-box and white-box models are fitted to,</li>
<li>
<code>data2</code> - the data used to create an <code>explainer</code> and a <code>safe_extractor</code> for black-box model from the previous point, serving also as a test data,</li>
<li>
<code>data3</code> - the data for which transformations and feature selection are performed, used also as a training set for new models,</li>
<li>
<code>data4</code> - the data used as a test set for the new models, allowing to compare the results. Before splitting the data, we first shuffle rows to ensure they are evenly distributed.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">111</span><span class="op">)</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span></span>
<span><span class="va">data1</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4000</span>,<span class="op">]</span></span>
<span><span class="va">data2</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="fl">4001</span><span class="op">:</span><span class="fl">8000</span>,<span class="op">]</span></span>
<span><span class="va">data3</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="fl">8001</span><span class="op">:</span><span class="fl">12000</span>,<span class="op">]</span></span>
<span><span class="va">data4</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="fl">12001</span><span class="op">:</span><span class="fl">14999</span>,<span class="op">]</span></span></code></pre></div>
<div class="section level2">
<h2 id="building-a-black-box-model">Building a black-box model<a class="anchor" aria-label="anchor" href="#building-a-black-box-model"></a>
</h2>
<p>In this example we decide to use the GBM model as a black-box - it will serve us as a surrogate.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n.trees</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/gbm-developers/gbm" class="external-link">gbm</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">111</span><span class="op">)</span></span>
<span><span class="va">model_xgb1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gbm/man/gbm.html" class="external-link">gbm</a></span><span class="op">(</span><span class="va">left</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">data1</span>, distribution <span class="op">=</span> <span class="st">"bernoulli"</span>, n.trees <span class="op">=</span> <span class="va">n.trees</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="creating-an-explainer">Creating an explainer<a class="anchor" aria-label="anchor" href="#creating-an-explainer"></a>
</h2>
<p>We also create an <code>explainer</code> object that will be used later to create new variables. For classification problems we need to specify <code>predict_function</code> - a function that may be used for model predictions and returns a single numerical value for each observation.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://modeloriented.github.io/DALEX/" class="external-link">DALEX</a></span><span class="op">)</span></span>
<span><span class="va">predict_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">x</span>, type <span class="op">=</span> <span class="st">"response"</span>, n.trees <span class="op">=</span> <span class="va">n.trees</span><span class="op">)</span></span>
<span><span class="va">explainer_xgb1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://modeloriented.github.io/DALEX/reference/explain.html" class="external-link">explain</a></span><span class="op">(</span><span class="va">model_xgb1</span>, data <span class="op">=</span> <span class="va">data2</span><span class="op">[</span>,<span class="op">-</span><span class="fl">7</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">data2</span><span class="op">$</span><span class="va">left</span>, predict_function <span class="op">=</span> <span class="va">predict_function</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="creating-a-safe_extractor">Creating a safe_extractor<a class="anchor" aria-label="anchor" href="#creating-a-safe_extractor"></a>
</h2>
<p>Now, we create a <code>safe_extractor</code> object using <code>rSAFE</code> package and our surrogate model. Setting the argument <code>verbose=FALSE</code> stops progress bar from printing.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">safe_extractor</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/safe_extraction.html">safe_extraction</a></span><span class="op">(</span><span class="va">explainer_xgb1</span>, penalty <span class="op">=</span> <span class="fl">20</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Now, let’s print summary for the new object we have just created.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">safe_extractor</span><span class="op">)</span></span>
<span><span class="co">#&gt; Variable 'satisfaction_level' - selected intervals:</span></span>
<span><span class="co">#&gt;  (-Inf, 0.48]</span></span>
<span><span class="co">#&gt;      (0.48, 0.9193878]</span></span>
<span><span class="co">#&gt;      (0.9193878, Inf)</span></span>
<span><span class="co">#&gt; Variable 'last_evaluation' - selected intervals:</span></span>
<span><span class="co">#&gt;  (-Inf, 0.42]</span></span>
<span><span class="co">#&gt;      (0.42, 0.57]</span></span>
<span><span class="co">#&gt;      (0.57, 0.8]</span></span>
<span><span class="co">#&gt;      (0.8, Inf)</span></span>
<span><span class="co">#&gt; Variable 'number_project' - selected intervals:</span></span>
<span><span class="co">#&gt;  (-Inf, 4]</span></span>
<span><span class="co">#&gt;      (4, Inf)</span></span>
<span><span class="co">#&gt; Variable 'average_monthly_hours' - selected intervals:</span></span>
<span><span class="co">#&gt;  (-Inf, 115.6122]</span></span>
<span><span class="co">#&gt;      (115.6122, 160]</span></span>
<span><span class="co">#&gt;      (160, 214]</span></span>
<span><span class="co">#&gt;      (214, Inf)</span></span>
<span><span class="co">#&gt; Variable 'time_spend_company' - selected intervals:</span></span>
<span><span class="co">#&gt;  (-Inf, 3]</span></span>
<span><span class="co">#&gt;      (3, Inf)</span></span>
<span><span class="co">#&gt; Variable 'work_accident' - no transformation suggested.</span></span>
<span><span class="co">#&gt; Variable 'promotion_last_5years' - no transformation suggested.</span></span>
<span><span class="co">#&gt; Variable 'salary' - created levels:</span></span>
<span><span class="co">#&gt;  high -&gt;  high </span></span>
<span><span class="co">#&gt;  low, medium -&gt;  low_medium</span></span></code></pre></div>
<p>We can see transformation propositions for all variables in our dataset.</p>
<p>In the plot below we can see which points have been chosen to be the breakpoints for a particular variable:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">safe_extractor</span>, variable <span class="op">=</span> <span class="st">"last_evaluation"</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_hr_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<p>For factor variables we can observe in which order levels have been merged and what is the optimal clustering:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">safe_extractor</span>, variable <span class="op">=</span> <span class="st">"salary"</span><span class="op">)</span></span></code></pre></div>
<p><img src="example_hr_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="transforming-data">Transforming data<a class="anchor" aria-label="anchor" href="#transforming-data"></a>
</h2>
<p>Now we can use our <code>safe_extractor</code> object to create new categorical features in the given dataset.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data3_trans</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/safely_transform_data.html">safely_transform_data</a></span><span class="op">(</span><span class="va">safe_extractor</span>, <span class="va">data3</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="2%">
<col width="7%">
<col width="6%">
<col width="5%">
<col width="8%">
<col width="7%">
<col width="5%">
<col width="1%">
<col width="8%">
<col width="8%">
<col width="7%">
<col width="7%">
<col width="9%">
<col width="8%">
<col width="4%">
</colgroup>
<thead><tr class="header">
<th align="left">salary</th>
<th align="right">satisfaction_level</th>
<th align="right">last_evaluation</th>
<th align="right">number_project</th>
<th align="right">average_monthly_hours</th>
<th align="right">time_spend_company</th>
<th align="right">work_accident</th>
<th align="right">left</th>
<th align="right">promotion_last_5years</th>
<th align="left">satisfaction_level_new</th>
<th align="left">last_evaluation_new</th>
<th align="left">number_project_new</th>
<th align="left">average_monthly_hours_new</th>
<th align="left">time_spend_company_new</th>
<th align="left">salary_new</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">low</td>
<td align="right">0.78</td>
<td align="right">0.77</td>
<td align="right">2</td>
<td align="right">177</td>
<td align="right">4</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">(0.48, 0.9193878]</td>
<td align="left">(0.57, 0.8]</td>
<td align="left">(-Inf, 4]</td>
<td align="left">(160, 214]</td>
<td align="left">(3, Inf)</td>
<td align="left">low_medium</td>
</tr>
<tr class="even">
<td align="left">low</td>
<td align="right">0.87</td>
<td align="right">0.94</td>
<td align="right">5</td>
<td align="right">219</td>
<td align="right">5</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">(0.48, 0.9193878]</td>
<td align="left">(0.8, Inf)</td>
<td align="left">(4, Inf)</td>
<td align="left">(214, Inf)</td>
<td align="left">(3, Inf)</td>
<td align="left">low_medium</td>
</tr>
<tr class="odd">
<td align="left">medium</td>
<td align="right">0.85</td>
<td align="right">1.00</td>
<td align="right">5</td>
<td align="right">244</td>
<td align="right">2</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">(0.48, 0.9193878]</td>
<td align="left">(0.8, Inf)</td>
<td align="left">(4, Inf)</td>
<td align="left">(214, Inf)</td>
<td align="left">(-Inf, 3]</td>
<td align="left">low_medium</td>
</tr>
<tr class="even">
<td align="left">medium</td>
<td align="right">0.24</td>
<td align="right">0.46</td>
<td align="right">7</td>
<td align="right">224</td>
<td align="right">5</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">(-Inf, 0.48]</td>
<td align="left">(0.42, 0.57]</td>
<td align="left">(4, Inf)</td>
<td align="left">(214, Inf)</td>
<td align="left">(3, Inf)</td>
<td align="left">low_medium</td>
</tr>
<tr class="odd">
<td align="left">low</td>
<td align="right">0.81</td>
<td align="right">0.49</td>
<td align="right">4</td>
<td align="right">285</td>
<td align="right">4</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">(0.48, 0.9193878]</td>
<td align="left">(0.42, 0.57]</td>
<td align="left">(-Inf, 4]</td>
<td align="left">(214, Inf)</td>
<td align="left">(3, Inf)</td>
<td align="left">low_medium</td>
</tr>
<tr class="even">
<td align="left">high</td>
<td align="right">0.72</td>
<td align="right">0.84</td>
<td align="right">2</td>
<td align="right">173</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">(0.48, 0.9193878]</td>
<td align="left">(0.8, Inf)</td>
<td align="left">(-Inf, 4]</td>
<td align="left">(160, 214]</td>
<td align="left">(-Inf, 3]</td>
<td align="left">high</td>
</tr>
</tbody>
</table>
<p>We can also perform feature selection if we wish. For each original feature it keeps exactly one of their forms - original one or transformed one.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">selected_variables</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/safely_select_variables.html">safely_select_variables</a></span><span class="op">(</span><span class="va">safe_extractor</span>, <span class="va">data3_trans</span>, which_y <span class="op">=</span> <span class="st">"left"</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">data3_trans_sel</span> <span class="op">&lt;-</span> <span class="va">data3_trans</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="va">selected_variables</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">selected_variables</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "work_accident"             "promotion_last_5years"    </span></span>
<span><span class="co">#&gt; [3] "salary"                    "satisfaction_level_new"   </span></span>
<span><span class="co">#&gt; [5] "last_evaluation_new"       "number_project_new"       </span></span>
<span><span class="co">#&gt; [7] "average_monthly_hours_new" "time_spend_company_new"</span></span></code></pre></div>
<p>It can be observed that for some features the original form was preferred and for others the transformed one.</p>
<p>Here are the first few rows for our data after feature selection:</p>
<table style="width:100%;" class="table">
<colgroup>
<col width="3%">
<col width="8%">
<col width="13%">
<col width="4%">
<col width="14%">
<col width="12%">
<col width="11%">
<col width="16%">
<col width="14%">
</colgroup>
<thead><tr class="header">
<th align="right">left</th>
<th align="right">work_accident</th>
<th align="right">promotion_last_5years</th>
<th align="left">salary</th>
<th align="left">satisfaction_level_new</th>
<th align="left">last_evaluation_new</th>
<th align="left">number_project_new</th>
<th align="left">average_monthly_hours_new</th>
<th align="left">time_spend_company_new</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">low</td>
<td align="left">(0.48, 0.9193878]</td>
<td align="left">(0.57, 0.8]</td>
<td align="left">(-Inf, 4]</td>
<td align="left">(160, 214]</td>
<td align="left">(3, Inf)</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">low</td>
<td align="left">(0.48, 0.9193878]</td>
<td align="left">(0.8, Inf)</td>
<td align="left">(4, Inf)</td>
<td align="left">(214, Inf)</td>
<td align="left">(3, Inf)</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">medium</td>
<td align="left">(0.48, 0.9193878]</td>
<td align="left">(0.8, Inf)</td>
<td align="left">(4, Inf)</td>
<td align="left">(214, Inf)</td>
<td align="left">(-Inf, 3]</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">medium</td>
<td align="left">(-Inf, 0.48]</td>
<td align="left">(0.42, 0.57]</td>
<td align="left">(4, Inf)</td>
<td align="left">(214, Inf)</td>
<td align="left">(3, Inf)</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">low</td>
<td align="left">(0.48, 0.9193878]</td>
<td align="left">(0.42, 0.57]</td>
<td align="left">(-Inf, 4]</td>
<td align="left">(214, Inf)</td>
<td align="left">(3, Inf)</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">1</td>
<td align="right">0</td>
<td align="left">high</td>
<td align="left">(0.48, 0.9193878]</td>
<td align="left">(0.8, Inf)</td>
<td align="left">(-Inf, 4]</td>
<td align="left">(160, 214]</td>
<td align="left">(-Inf, 3]</td>
</tr>
</tbody>
</table>
<p>Now, we perform transformations on another data that will be used later to compare models performance.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data4_trans</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/safely_transform_data.html">safely_transform_data</a></span><span class="op">(</span><span class="va">safe_extractor</span>, <span class="va">data4</span>, verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">data4_trans_sel</span> <span class="op">&lt;-</span> <span class="va">data4_trans</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"left"</span>, <span class="va">selected_variables</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="creating-white-box-models-on-original-and-transformed-datasets">Creating white-box models on original and transformed datasets<a class="anchor" aria-label="anchor" href="#creating-white-box-models-on-original-and-transformed-datasets"></a>
</h2>
<p>Let’s fit the models to data containing newly created columns. We consider a generalized linear model (glm) as a white-box model.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_lr2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">left</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">data3_trans_sel</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">111</span><span class="op">)</span></span>
<span><span class="va">model_xgb2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/gbm/man/gbm.html" class="external-link">gbm</a></span><span class="op">(</span><span class="va">left</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">data3_trans_sel</span>, distribution <span class="op">=</span> <span class="st">"bernoulli"</span>, n.trees <span class="op">=</span> <span class="va">n.trees</span><span class="op">)</span></span></code></pre></div>
<p>Moreover, we create a glm model based on original data in order to check if our methodology improves results.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_lr1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">left</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">data1</span>, family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">binomial</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="comparing-models-performance">Comparing models performance<a class="anchor" aria-label="anchor" href="#comparing-models-performance"></a>
</h2>
<p>Final step is the comparison of all four models we have created. For each of them we make predictions on the relevant test set, i.e. we use <code>model_lr1</code> and <code>model_xgb1</code> to predict the output for <code>data2</code> and <code>model_lr2</code> and <code>model_xgb2</code> to predict the output for <code>data4</code>.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred_lr1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model_lr1</span>, <span class="va">data2</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pred_xgb1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model_xgb1</span>, <span class="va">data2</span>, n.trees <span class="op">=</span> <span class="va">n.trees</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pred_lr2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model_lr2</span>, <span class="va">data4_trans_sel</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">pred_xgb2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">model_xgb2</span>, <span class="va">data4_trans_sel</span>, n.trees <span class="op">=</span> <span class="va">n.trees</span>, type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The performance of the models may then be evaluated based on confusion matrices with relative percentages obtained via the <code>confusion_matrix</code> function:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">confusion_matrix</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y_true</span>, <span class="va">y_pred</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">cm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>pred_0 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">y_true</span><span class="op">==</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">y_pred</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">y_true</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>                              <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">y_true</span><span class="op">==</span><span class="fl">1</span> <span class="op">&amp;</span> <span class="va">y_pred</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">y_true</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                   pred_1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">y_true</span><span class="op">==</span><span class="fl">0</span> <span class="op">&amp;</span> <span class="va">y_pred</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">y_true</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span>,</span>
<span>                              <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">y_true</span><span class="op">==</span><span class="fl">1</span> <span class="op">&amp;</span> <span class="va">y_pred</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">y_true</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">cm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">cm</span>, MARGIN <span class="op">=</span> <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">x</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">cm</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"actual_0"</span>, <span class="st">"actual_1"</span><span class="op">)</span></span>
<span>  <span class="va">cm</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>GBM models give the following results:</p>
<ul>
<li>for the original data:</li>
</ul>
<table style="width:71%;" class="table">
<colgroup>
<col width="20%">
<col width="25%">
<col width="25%">
</colgroup>
<thead><tr class="header">
<th align="center"> </th>
<th align="center"><strong>predicted 0</strong></th>
<th align="center"><strong>predicted 1</strong></th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center"><strong>actual 0</strong></td>
<td align="center">0.97</td>
<td align="center">0.03</td>
</tr>
<tr class="even">
<td align="center"><strong>actual 1</strong></td>
<td align="center">0.09</td>
<td align="center">0.91</td>
</tr>
</tbody>
</table>
<ul>
<li>for the data with <code>rSAFE</code> transformations applied:</li>
</ul>
<table style="width:71%;" class="table">
<colgroup>
<col width="20%">
<col width="25%">
<col width="25%">
</colgroup>
<thead><tr class="header">
<th align="center"> </th>
<th align="center"><strong>predicted 0</strong></th>
<th align="center"><strong>predicted 1</strong></th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center"><strong>actual 0</strong></td>
<td align="center">0.93</td>
<td align="center">0.07</td>
</tr>
<tr class="even">
<td align="center"><strong>actual 1</strong></td>
<td align="center">0.27</td>
<td align="center">0.73</td>
</tr>
</tbody>
</table>
<p>The model trained on original data has higher predictive power - feature transformations have caused the loss of valuable information which was apparently used by the first model. However, within logistic regression models the significant improvement can be observed:</p>
<ul>
<li>for the original data:</li>
</ul>
<table style="width:71%;" class="table">
<colgroup>
<col width="20%">
<col width="25%">
<col width="25%">
</colgroup>
<thead><tr class="header">
<th align="center"> </th>
<th align="center"><strong>predicted 0</strong></th>
<th align="center"><strong>predicted 1</strong></th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center"><strong>actual 0</strong></td>
<td align="center">0.92</td>
<td align="center">0.08</td>
</tr>
<tr class="even">
<td align="center"><strong>actual 1</strong></td>
<td align="center">0.63</td>
<td align="center">0.37</td>
</tr>
</tbody>
</table>
<ul>
<li>for the data with <code>rSAFE</code> transformations applied:</li>
</ul>
<table style="width:71%;" class="table">
<colgroup>
<col width="20%">
<col width="25%">
<col width="25%">
</colgroup>
<thead><tr class="header">
<th align="center"> </th>
<th align="center"><strong>predicted 0</strong></th>
<th align="center"><strong>predicted 1</strong></th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center"><strong>actual 0</strong></td>
<td align="center">0.93</td>
<td align="center">0.07</td>
</tr>
<tr class="even">
<td align="center"><strong>actual 1</strong></td>
<td align="center">0.27</td>
<td align="center">0.73</td>
</tr>
</tbody>
</table>
<p>The initial logistic regression model has difficulties with “true negatives” - for employees that actually quit it very often predicts the opposite. On the other hand, <code>model_lr2</code> which was trained on the set of features modified by the SAFE algorithm has much better accuracy.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by .</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a>.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
